@page "/weather/{code}"
@using NS.Shared.Models.Weather
@using NS.WEB.Modules.Country.Resources
@using Button = NS.WEB.Resources.Button
@using SD.WEB.Shared.Core
@inherits PageCore<News>

@inject CacheWeatherApi CacheWeatherApi

<SeoHeader Title="@Translations.WeatherTitle" Description="@Translations.WeatherDescription" Keywords="@(new[] { "weather" })" Url="/weather"></SeoHeader>
<NewPageSection Title="@Translations.WeatherTitle" Description="@Translations.WeatherDescription" Icon="@IconsFA.Solid.Icon("cloud-sun-rain").Font"></NewPageSection>

<GoogleAdSense Section="@GoogleAdSense.AdUnit.Index"></GoogleAdSense>

<RenderControl Actions="Actions">
    <div class="grid-relative-container-news">
        @* @foreach (var item in NewsList?.Data?.Items ?? [])
        {
            <MudCard Style="position: relative;">
                <MudCardMedia Image="@item.url_img" Height="300" />
                <MudChip T="string" Label="true" Color="Color.Secondary" Class="poster-chip" Style="top: 8px; left: 8px; position: absolute; opacity: 0.75;" Size="AppStateStatic.Size">
                    @item.date.Humanize()
                </MudChip>
                <MudButton Color="Color.Primary" Href="@item.link" Target="_blank" Rel="noindex, nofollow" 
                           Style="top: 8px; right: 8px; position: absolute; opacity: 0.75;" Variant="Variant.Filled">
                    @Button.ReadMore
                </MudButton>
                <MudCardContent Style="text-align: justify;" Class="pa-2">
                    <MudText Typo="Typo.subtitle1" Color="Color.Secondary" Align="Align.Center" Style="line-height: 1.5">@((MarkupString)item.title!)</MudText>
                    <div class="mt-2">
                        <MudText Typo="Typo.caption">@item.text</MudText>
                    </div>
                </MudCardContent>
            </MudCard>
        } *@
    </div>
</RenderControl>

<div style="position: fixed; bottom: 16px; right: 16px; display: flex; z-index: 1000;">
    <MudFab Color="Color.Secondary" StartIcon="@Icons.Material.Filled.ArrowBack" Size="Size.Medium" OnClick="@(() => JsRuntime.Window().HistoryBack())" />
</div>

@code {
    [SupplyParameterFromQuery][Parameter] public required string code { get; set; }

    public ComponentActions<CacheDocument<WeatherModel>?> Actions { get; set; } = new(obj => obj?.Data == null || obj.Data.Current == null);
    private CacheDocument<WeatherModel>? WeatherData { get; set; }
    public string? SelectedSlide { get; set; }

    protected override async Task ProcessPageData()
    {
        await Actions.StartLoading.Invoke(null);
        WeatherData = await CacheWeatherApi.GetWeather(code, "full");
        await Actions.FinishLoading.Invoke(WeatherData);
    }

}
