@page "/admin"
@using System.Text.Json
@using Microsoft.AspNetCore.Authorization
@using NS.WEB.Modules.Country.Core
@attribute [Authorize(Roles = "administrator")]

@inherits PageCore<AdminPage>

@inject ScrapApi ScrapApi

<SeoHeader Title="admin" Description="admin" Url="/admin" Index="false" Keywords="@([])"></SeoHeader>

<MudSelect @bind-Value="Field" Label="Field" FullWidth="true" Clearable="true" Class="mb-4">
    @foreach (var item in EnumHelper.GetArray<Field>())
    {
        <MudSelectItem Value="item">@item</MudSelectItem>
    }
</MudSelect>

<MudButton OnClick="@ScrapData" Color="Color.Primary" Variant="Variant.Filled">
    Import Data
</MudButton>

@code {
    public Field Field { get; set; } = EnumHelper.GetArray<Field>().Last();

    protected async Task ScrapData()
    {
        try
        {
            await ScrapApi.ScrapPopulation(Field);

            await ShowSuccess("Scrap Finished");
        }
        catch (Exception ex)
        {
            await ProcessException(ex);
        }
    }
}
