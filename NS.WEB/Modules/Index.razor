@page "/"
@page "/index"
@using NS.WEB.Modules.Country.Core

@inherits PageCore<Index>

@inject AllCountriesApi AllCountriesApi

<SeoHeader Title="Match with your next destination" Description="@SeoTranslations.AppDescription" Url="/" Keywords="@(["country"])"></SeoHeader>

@* <GoogleAdSense Section="@GoogleAdSense.AdUnit.Index" IsAuthenticated="IsAuthenticated"></GoogleAdSense> *@

@if (Countries != null)
{
    <MudGrid Class="mb-4">
        <MudItem xs="6">
            <MudSelect @bind-Value="region" Label="Region" FullWidth="true" Clearable="true">
                @foreach (var item in Countries.GetRegions())
                {
                    <MudSelectItem Value="item">@item</MudSelectItem>
                }
            </MudSelect>
        </MudItem>
        <MudItem xs="6">
            <MudSelect @bind-Value="subregion" Label="Subregion" FullWidth="true" Clearable="true">
                @foreach (var item in Countries.GetSubRegions(region))
                {
                    <MudSelectItem Value="item">@item</MudSelectItem>
                }
            </MudSelect>
        </MudItem>
    </MudGrid>

    <MudGrid Spacing="4">
        @foreach (var item in Countries.GetCountries(region, subregion))
        {
            <MudItem xs="6" sm="3" md="2" xl="1" Style="text-align: center;">
                <MudPaper Class="pa-2">
                    <MudLink Href="@($"country/{item.Id.ToLower()}")">
                        <MudImage Src="@item.Flag" Height="64"></MudImage>
                        <MudText>@item.Name</MudText>
                    </MudLink>
                </MudPaper>
            </MudItem>
        }
    </MudGrid>
}

@code {

    private AllCountries? Countries { get; set; }

    private string? region;
    private string? subregion;

    protected override async Task LoadEssentialDataAsync()
    {
        Countries = await AllCountriesApi.GetAll(null);
    }

}