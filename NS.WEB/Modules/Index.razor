@page "/"
@page "/index"
@using NS.WEB.Modules.Country.Components
@using NS.WEB.Modules.Country.Core
@using NS.WEB.Modules.Explore.Components
@using NS.WEB.Modules.Subscription.Core
@using SD.WEB.Shared.Core

@inherits PageCore<Index>

@inject AllRegionsApi AllRegionsApi
@inject IpInfoApi IpInfoApi
@inject IpInfoServerApi IpInfoServerApi

<SeoHeader Title="@SeoTranslations.AppSubtitle" Description="@SeoTranslations.AppDescription" Url="/" Keywords="@(["country"])"></SeoHeader>
<NewPageSection IsPageHeader="true" Image="icon/icon-71.png" Title="@SeoTranslations.AppName" Subtitle="@SeoTranslations.AppSubtitle" />

<GoogleAdSense Section="@GoogleAdSense.AdUnit.Index"></GoogleAdSense>

<RenderControl Actions="Actions">
    <MostVisitedCities AllRegions="AllRegions" Country="@country"></MostVisitedCities>
    <GlobalCities AllRegions="AllRegions" Country="@country"></GlobalCities>
    <BestDestinations AllRegions="AllRegions" Country="@country"></BestDestinations>
</RenderControl>

<GoogleAdSense Section="@GoogleAdSense.AdUnit.Index2"></GoogleAdSense>

<MudGrid Spacing="@Css.SpaceSmall">
    <MudItem xs="12" sm="6">
        <TopicNewsComponent></TopicNewsComponent>
    </MudItem>
    <MudItem xs="12" sm="6">
    </MudItem>
</MudGrid>

@code {
    private AllRegions? AllRegions { get; set; }
    private ComponentActions<AllRegions?> Actions { get; set; } = new(obj => obj == null || obj.Items.Empty());
    private string? country;

    protected override async Task ProcessInitialData()
    {
        country = await AppStateStatic.GetCountry(IpInfoApi, IpInfoServerApi, JsRuntime);

        await Actions.StartLoading.Invoke(null);
        AllRegions = await AllRegionsApi.GetAll();
        await Actions.FinishLoading.Invoke(AllRegions);
    }
}
